<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8" />
	<title>RSS Parser</title>
	<link rel="stylesheet" type="text/css" href="ticker-style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script src="webticker.min.js"></script>
</head>

	<body>


		<div id="foo">	

			<ul >
				<li>
					<img id="img1" src="#" alt="dunno">
					<h1 class="eventH">Header</h1>
					<p class="eventDescription">Content</p>
					<p class="eventDate">Date</p>
				</li>
				<li class="event">
					<img src="#" alt="dunno">
					<h1 class="eventH">Header</h1>
					<p>Content</p>
					<p>Date</p>
				</li>
				<li class="event">
					<img src="#" alt="dunno">
					<h1 class="eventH">Header</h1>
					<p>Content</p>
					<p>Date</p>
				</li>
				<li class="event">
					<img src="#" alt="dunno">
					<h1 class="eventH">Header</h1>
					<p>Content</p>
					<p>Date</p>
				</li>
				<li class="event">
					<img src="#" alt="dunno">
					<h1 class="eventH">Header</h1>
					<p>Content</p>
					<p>Date</p>
				</li>
			</ul>

		</div>	



	</body>
	
	
	<script>
		
		
		//globals
		var headers = new Array();
		var descriptions = new Array();
		var imgURLs = ['https://static.campuslabsengage.com/discovery/images/events/groupbusiness.jpg'];//this sets the default image at 0 position;
		
		var hDom = new Array();
		var dDom = new Array();
		var imgDom = new Array();
		
		$.fn.immediateText = function(){
			return this.contents().not(this.children()).text();
		}

		function strip_html(str){
			if((str ===null) || (str===''))
				return false;
			else 
				str = str.toString();
				
			str.replace(/&nbsp;/gi,'');
			return str.replace(/<[^>]*>/g, '');
		}
		
		$(document).ready(function(){
			var feed = "https://american.campuslabs.com/engage/events.rss"
		
			console.log($('.eventH').text());
		
		
			
			$.ajax(feed,{
				accepts:{
					xml:"application/rss+xml"
				},
				dataType:"xml",
				success:function(data){
					$(data).find("item").each(function(){
						var el = $(this);
						var desc = el.find('description').text();
						var url = el.find('enclosure').attr('url');
						
					
					
						//console.log("------");
						//console.log("title  : " + el.find("title").text());					
						
						headers.push(el.find("title").text());
						imgURLs.push(url);
						descriptions.push(strip_html(desc).trim());
						
						//console.log("description : " + strip_html(desc).trim());
						//console.log("description length : " + desc.length);
						
					});
				}
			});
			
		});
		
		function getRandomInt(max){
			return Math.floor(Math.random() * Math.floor(max));
		}
		
		function assignHeaders(val){ //val is the "page value" to determine what page of events we see
			var i=val*7;
			$('.eventH').each(function(){
				i++;
				$(this).text(headers[i]);
				
				
			});
		}
		
		function limitText(str){
			if(str.length > 190){
				var outText = str.substring(0,187) + "...";
				//alert(outText);
			}
		}
		
		
		//Keypress test
		$(document).keydown(function(e){
			if(e.keyCode == 32){ //spacebar
				console.log("Header length " + headers.length);
				assignHeaders(2);
				
				//alert("Descriptions Lenght: " + descriptions.length + " \n" + getRandomInt(descriptions.length) + " \n"  + descriptions[getRandomInt(descriptions.length)]);				
				limitText(descriptions[getRandomInt(descriptions.length)]);
			}
		});
		

		

	</script>
</html>


